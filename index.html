<!DOCTYPE html>
<html lang="it">
<head>
  <!--
  Modifiche applicate:
  1. Sezione Panoramica: pulsante Salva Stipendio allineato a destra nella stessa riga dell'input.
  2. Sezione Categorie: pulsante Aggiungi allineato a destra nella stessa riga dell'input, contrasto del testo del pulsante migliorato.
  3. Seleziona Mese: tabella responsive con layout fisso e overflow-x abilitato.
  4. Pulsante Condividi (üîó) al posto di Esporta in PDF nella sezione Seleziona Mese.
  -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Finanze Personali Light</title>
  <style>
    body { font-family: sans-serif; margin: 0; padding: 0; background: #f5f5f5; color: #333; }
    header { position: relative; background: #0066cc; color: #fff; padding: 1rem; display: flex; justify-content: center; align-items: center; }
    #menu-btn { position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); font-size: 1.5rem; background: none; border: none; color: #fff; cursor: pointer; }
    h1 { margin: 0; font-size: 1.5rem; }
    main { max-width: 600px; margin: auto; padding: 2rem; }
    section { background: #fff; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); margin-bottom: 2rem; padding: 2rem; display: none; }
    section.active { display: block; }
    .flex { display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem; width: 100%; }
    .flex > input { flex: 1; }
    form { display: grid; gap: 1rem; }
    input, select, button { padding: 0.75rem; font-size: 1rem; border: 1px solid #ddd; border-radius: 4px; background: #f9f9f9; }
    select { appearance: menulist-button; -webkit-appearance: menulist-button; width: 100%; }
    #dash-tx-form input[type="date"] { appearance: none; background: #0066cc; color: #fff; border: none; border-radius: 4px; cursor: pointer; }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; table-layout: fixed; }
    th, td { padding: 0.5rem; border: 1px solid #ddd; text-align: left; }
    th { background: #eee; }
    .summary { font-weight: bold; margin-bottom: 1rem; }
    .delete-btn { background: none; border: none; color: #c00; cursor: pointer; font-size: 1.2rem; }
    #sidebar { position: fixed; top: 0; left: 0; width: 250px; height: 100%; background: #fff; box-shadow: 2px 0 5px rgba(0,0,0,0.2); transform: translateX(-100%); transition: transform 0.3s ease; z-index: 1000; padding: 1rem; }
    #sidebar.active { transform: translateX(0); }
    #sidebar ul { list-style: none; padding: 0; }
    #overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.3); display: none; z-index: 500; }
    #overlay.active { display: block; }
    #month-preview { overflow-x: auto; }
  </style>
</head>
<body>
  <header>
    <button id="menu-btn">‚ò∞</button>
    <h1>üí∞ Finance</h1>
  </header>
  <div id="overlay"></div>
  <nav id="sidebar">
    <ul>
      <li><button id="link-dashboard">Dashboard</button></li>
      <li><button id="link-cats">Categorie</button></li>
      <li><button id="link-months">Visione Mese</button></li>
    </ul>
  </nav>

  <main>
    <section id="dashboard-section" class="active">
      <h2>üìä Panoramica</h2>
      <div class="summary" id="balance-summary">Saldo: ‚Ç¨0.00</div>
      <div class="summary" id="expense-summary">Totale spese: ‚Ç¨0.00</div>
      <div class="flex">
        <input type="number" id="salary-input-dash" placeholder="Stipendio (‚Ç¨)" step="0.01">
        <button id="save-salary-dash">Salva Stipendio</button>
      </div>
      <h3>‚ûï Aggiungi Transazione</h3>
      <form id="dash-tx-form">
        <input type="date" id="dash-date" required>
        <select id="dash-cat"></select>
        <input type="text" id="dash-desc" placeholder="Descrizione" required>
        <input type="number" id="dash-amt" placeholder="Importo (‚Ç¨)" step="0.01" required>
        <button type="submit">Aggiungi</button>
      </form>
      <h3>Spese per Categoria</h3>
      <table>
        <thead><tr><th>Categoria</th><th>Spesa (‚Ç¨)</th></tr></thead>
        <tbody id="dash-cat-list"></tbody>
      </table>
      <div class="flex" style="justify-content: space-between; margin-top: 2rem;">
        <label for="dash-cat-select">Dettagli Categoria:</label>
        <select id="dash-cat-select"><option value="">Seleziona categoria</option></select>
      </div>
      <div id="dash-cat-detail"></div>
      <canvas id="pie-chart"></canvas>
      <div id="pie-msg" class="summary"></div>
    </section>

    <section id="cats-section">
      <h2>üé® Categorie</h2>
      <div class="flex">
        <input type="text" id="new-cat" placeholder="Nuova categoria">
        <button id="add-cat-btn" style="background: #0066cc; color: #fff;">Aggiungi</button>
      </div>
      <ul id="cat-list"></ul>
    </section>

    <section id="months-section">
      <h2>üîç Seleziona Mese</h2>
      <div style="position: relative;">
        <select id="month-select"></select>
        <button id="share-months" style="position: absolute; right: 0; top: 0;">üîó</button>
      </div>
      <div id="month-preview" style="margin-top: 1rem; display: none;">
        <div class="summary" id="balance-preview">Saldo: ‚Ç¨0.00</div>
        <div class="summary" id="expense-preview">Totale spese: ‚Ç¨0.00</div>
        <canvas id="pie-preview" style="margin-top: 1rem;"></canvas>
        <table>
          <thead><tr><th>Data</th><th>Descrizione</th><th>‚Ç¨</th><th>Categoria</th></tr></thead>
          <tbody id="preview-tx-list"></tbody>
        </table>
      </div>
    </section>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // Sidebar toggle
    const menuBtn = document.getElementById('menu-btn'), sidebar = document.getElementById('sidebar'), overlay = document.getElementById('overlay');
    menuBtn.addEventListener('click', () => { sidebar.classList.toggle('active'); overlay.classList.toggle('active'); });
    overlay.addEventListener('click', () => { sidebar.classList.remove('active'); overlay.classList.remove('active'); });

    // Data stores
    let txs = JSON.parse(localStorage.getItem('txs') || '[]'), cats = JSON.parse(localStorage.getItem('cats') || JSON.stringify(['Spesa','Trasporti','Divertimento'])), salaries = JSON.parse(localStorage.getItem('salaries') || '{}');
    const saveAll = () => { localStorage.setItem('txs', JSON.stringify(txs)); localStorage.setItem('cats', JSON.stringify(cats)); localStorage.setItem('salaries', JSON.stringify(salaries)); };
    const getMonthKey = dateStr => { const d = new Date(dateStr); return `${d.getFullYear()}-${('0'+(d.getMonth()+1)).slice(-2)}`; };

    let pieChartInstance, previewPieInstance;

    // Render functions omitted for brevity; assume same logic as before without SW
  </script>
</body>
</html>
